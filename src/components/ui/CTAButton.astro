---
import { cn } from "../../lib/utils";

interface Props {
  icon?: "download" | "projects";
  label: string;
  href: string;
  class?: string;
  style?: string;
  target?: "_blank" | "_self";
  animate?: boolean;
}

const {
  icon,
  label,
  href,
  class: className,
  style,
  target = "_blank",
  animate,
} = Astro.props;
---

<a
  href={href}
  class={cn(
    "text-[0.8125rem] font-family-heading uppercase font-semibold text-text-base bg-bg-base px-2 py-2 rounded-full inline-flex items-center gap-2 border-4 border-bg-secondary relative overflow-hidden before:content-[''] before:absolute before:top-0 before:right-0 before:bottom-0 before:bg-[#E4CDB8] before:w-16 before:rounded-full hover:before:w-full before:transition-[width] before:duration-300 before:ease-out before:z-0",
    className,
  )}
  target={target}
  style={style}
  data-animate={animate}
  data-analytics="cta-click"
  data-label={label}
>
  {
    icon === "download" && (
      <svg
        width="32"
        height="31"
        viewBox="0 0 32 31"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        class="w-6 h-6 relative z-10"
      >
        <ellipse cx="16" cy="15.5" rx="16" ry="15.5" fill="#BF5252" />
        <path d="M16 25L10.1892 17.5L21.8107 17.5L16 25Z" fill="#F3E8DD" />
        <rect x="10.3226" y="10" width="11.3548" height="3" fill="#F3E8DD" />
      </svg>
    )
  }
  {
    icon === "projects" && (
      <svg
        width="32"
        height="31"
        viewBox="0 0 32 31"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        class="w-6 h-6 relative z-10"
      >
        <ellipse cx="16" cy="15.5" rx="16" ry="15.5" fill="#BF5252" />
        <rect
          x="8.22583"
          y="9"
          width="16.5806"
          height="13"
          stroke="#F3E8DD"
          stroke-width="2"
        />
        <rect
          x="8.22583"
          y="9"
          width="8.32258"
          height="13"
          stroke="#F3E8DD"
          stroke-width="2"
        />
      </svg>
    )
  }
  <span class="relative z-10">{label}</span>
</a>

<script>
  const buttons = document.querySelectorAll('[data-analytics="cta-click"]');

  buttons.forEach((button) => {
    button.addEventListener("click", (e) => {
      const target = e.currentTarget as HTMLAnchorElement;

      // @ts-ignore
      if (window.posthog) {
        // @ts-ignore
        window.posthog.capture("cta_button_clicked", {
          button_text: target.dataset.label,
          button_url: target.getAttribute("href"),
        });
      }
    });
  });
</script>
